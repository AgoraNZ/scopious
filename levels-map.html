<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Vat Levels Map</title>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
    crossorigin=""
  />
  <style>
    body, html { margin:0; padding:0; height:100%; }
    #map { width:100%; height:100%; }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js" crossorigin=""></script>
  <script>
    // Load farms + vats
    const farms = JSON.parse(localStorage.getItem('farms')||'[]');

    // Tumeke map
    const map = L.map('map').setView([-42, 173], 6);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution:'© OpenStreetMap'
    }).addTo(map);

    // Pre‐defined farmland centroids
    const coords = [
      {lat:-41.75806, lng:171.60222}, // Westport :contentReference[oaicite:0]{index=0}
      {lat:-42.4503,  lng:171.2079 }, // Greymouth :contentReference[oaicite:1]{index=1}
      {lat:-42.71556, lng:170.96806}, // Hokitika :contentReference[oaicite:2]{index=2}
      {lat:-37.8833,  lng:175.4667 }, // Cambridge :contentReference[oaicite:3]{index=3}
      {lat:-37.7833,  lng:175.2833 }, // Hamilton :contentReference[oaicite:4]{index=4}
      {lat:-38.017,   lng:175.317  }  // Te Awamutu :contentReference[oaicite:5]{index=5}
    ];

    farms.forEach((f,i) => {
      // pick one of the coords (wrap if farms > coords)
      const loc = coords[i % coords.length];
      const popupText = `<strong>#${f.supplier}</strong><br>` +
        f.vats.map((v,j)=>`Vat ${j+1}: ${v.toLocaleString()} L`).join('<br>');

      L.marker([loc.lat, loc.lng])
        .addTo(map)
        .bindTooltip(popupText, {permanent:true, direction:'right'});
    });
  </script>
</body>
</html>
