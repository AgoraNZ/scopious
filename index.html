<!DOCTYPE html>
<html lang="en">
<head>
  <!-- ‚Ä¶ your existing head ‚Ä¶ -->
  <style>
    /* ‚Ä¶ your existing styles ‚Ä¶ */
    .vat-info {
      font-size: 0.85rem;
      color: #ccc;
      text-align: right;
      margin-bottom: 8px;
    }
    .vat-info div {
      margin: 2px 0;
    }
    .map-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #3498db;
      color: #fff;
      border: none;
      padding: 8px 12px;
      border-radius: 4px;
      cursor: pointer;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <button class="map-btn" onclick="location.href='levels-map.html'">
    üìç Map View
  </button>

  <div class="container">
    <!-- ‚Ä¶ your existing summary, add‚Äêfarm, search ‚Ä¶ -->

    <div class="cards" id="card-container"></div>

    <!-- ‚Ä¶ permissions, footer ‚Ä¶ -->
  </div>

  <script>
    // ‚Ä¶ your existing constants ‚Ä¶

    // Extend loadFarms to initialize vats
    function loadFarms(){
      let f = JSON.parse(localStorage.getItem(LS_FARMS)||'null');
      if(!f){
        f = Object.keys(historyCfg).map(s=>({
          supplier:s,name:'',activeAlarms:[...ALARMS]
        }));
      }
      // initialize vats for each farm if missing
      let changed = false;
      f.forEach(farm=>{
        if(!farm.vats){
          // always at least one vat
          const vats = [];
          vats.push(Math.floor(Math.random()*20000));
          if(Math.random()<0.1){
            vats.push(Math.floor(Math.random()*20000));
          }
          farm.vats = vats;
          changed = true;
        }
      });
      if(changed) localStorage.setItem(LS_FARMS, JSON.stringify(f));
      return f;
    }
    // ‚Ä¶ rest of load/save ‚Ä¶

    // When rendering cards, inject vat‚Äêinfo
    function renderCards(rows){
      const container = document.getElementById('card-container');
      container.innerHTML = '';
      rows.forEach(r=>{
        // ‚Ä¶ ticket logic ‚Ä¶
        const vatsHtml = r.vats.map((v,i)=>
          `<div>Vat ${i+1}: ${v.toLocaleString()} L</div>`
        ).join('');
        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
          <div class="card-header">
            <a href="dashboard.html?supplier=${r.supplier}" class="supplier">
              #${r.supplier}
            </a>
            <div class="farm-name">${r.name}</div>
            <div class="vat-info">
              ${vatsHtml}
            </div>
          </div>
          <div class="card-body">
            <a href="alarm.html?supplier=${r.supplier}">
              <div class="status status-${r.status.toLowerCase()}">
                <span class="dot"></span>${r.status}
              </div>
              <div class="alarm-name">${r.alarm}</div>
              <div class="time">${r.time}</div>
            </a>
          </div>
          <div class="card-actions">
            ${ticketHTML}
            ${currentRole==='admin'
              ? `<button class="btn-edit" onclick="
                  location.href='setup.html?\
supplier=${r.supplier}'">Edit</button>`
              : ''}
          </div>
        `;
        container.appendChild(card);
      });
    }

    // ‚Ä¶ rest of your existing script ‚Ä¶
  </script>
</body>
</html>
